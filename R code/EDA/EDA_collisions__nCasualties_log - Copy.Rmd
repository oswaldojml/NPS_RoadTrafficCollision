---
title: "Nonparametric Analysis of UK Road Accidents"
subtitle: "Exploratory Data Analysis: number of casualties"
author:
    - "Valeria Iapaolo"
    - "Oswaldo Morales"
    - "Riccardo Morandi"
    - "Abylai Orynbassar"
output:
    html_document:
        toc: true
        toc_float: true
        number_sections: true
    pdf_document:
        toc: true
        toc_depth: 3
        number_section: true
date: "2023-12-08"
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(
    echo = TRUE,
    #dev = c('pdf'),
    fig.align = 'center',
    #fig.path = 'output/',
    fig.height = 6,
    fig.width = 12
)
```

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
library(patchwork)
```

```{r}
load("../../clean data/full_collisions.RData")


# At the moment, just year few years
full_collisions <- full_collisions %>% filter(accident_year %in% c(2015,2016,2017,2018))

```

```{r}
glimpse(full_collisions)
```

```{r}
fill_colors <- 
  full_collisions %>% 
  select(number_of_casualties) %>%
  mutate(number_of_casualties = 
           ifelse(number_of_casualties <= 4, as.character(number_of_casualties), '5+'))

fill_colors = as.factor(fill_colors$number_of_casualties)
```


## distribution

```{r}
full_collisions %>% ggplot(aes(number_of_casualties, fill = fill_colors)) +
  geom_bar() + xlim(c(0,10))

```

Since we are going to model the number of causalties, 



## severity

```{r}
full_collisions %>% ggplot(aes(x = accident_severity, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_y_log10()
```
## year


fixing the scale to see the proportions:

```{r}
full_collisions %>% ggplot(aes(x = accident_year, fill = fill_colors)) + 
  geom_bar(position = "fill")
```

the composition seems to change over the years, more serious than slight

## time

```{r}
full_collisions %>% ggplot(aes(time,color = fill_colors)) + geom_freqpoly(bins = 48)
```

```{r}
full_collisions %>% ggplot(aes(time,color = fill_colors)) + geom_freqpoly(bins = 48) + scale_y_log10()
```

```{r}
full_collisions %>% ggplot(aes(time, color = fill_colors)) + 
  geom_line(stat = "count", size = 1,) + scale_y_log10() +
  theme_minimal()
```
TODO: need a plot to see the proportions 

## day of the week

```{r}
full_collisions %>% ggplot(aes(x = day_of_week, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_y_log10()
```


## date

```{r}
# not necessary
```


we can try to look for a trend in the day of the month:

```{r}
full_collisions %>% mutate(n_accidents = n(),day = mday(date)) %>%  ggplot(aes(day,color = as.factor(accident_year))) + geom_freqpoly(bins = 31) + theme(legend.position = "none") + scale_y_log10()
```
nothing

## number of vehicles:

```{r}
full_collisions %>% ggplot(aes(x = number_of_vehicles, fill = fill_colors)) + 
  geom_bar(position = "fill") + xlim(c(1,10)) + scale_y_log10()
```


## first road class:

```{r}
full_collisions %>% ggplot(aes(x = first_road_class, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_y_log10()
```

## second roadd class

```{r}
full_collisions %>% ggplot(aes(x = second_road_class, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 90)) + scale_y_log10()
```

## road type


```{r}
full_collisions %>% ggplot(aes(x = road_type, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 90)) + scale_y_log10()
```

## speed limit

```{r}
full_collisions %>% ggplot(aes(x = as.factor(speed_limit), fill = fill_colors)) + 
  geom_bar(position = "fill")  + scale_y_log10()
```

## junction detail

```{r}
full_collisions %>% ggplot(aes(x = junction_detail, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 90)) + scale_y_log10()
```

## junction control

```{r}
full_collisions %>% ggplot(aes(x = junction_control, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 90)) + scale_y_log10()
```

## pedestrian_crossing_human_control

```{r}
full_collisions %>% ggplot(aes(x = pedestrian_crossing_human_control, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) + scale_y_log10()
```

## pedestrian_crossing_physical_facilities

```{r}
full_collisions %>% ggplot(aes(x = pedestrian_crossing_physical_facilities, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) + scale_y_log10()
```

## light_conditions

```{r}
full_collisions %>% ggplot(aes(x = light_conditions, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) +
  theme(legend.position = "none") + scale_y_log10()
```

## weather_conditions

```{r}
full_collisions %>% ggplot(aes(x = weather_conditions, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) +
  theme(legend.position = "none") + scale_y_log10()
```

## special_conditions_at_site

```{r}
full_collisions %>% ggplot(aes(x = special_conditions_at_site, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) + scale_y_log10()
```

## carriageway_hazards

```{r}
full_collisions %>% ggplot(aes(x = carriageway_hazards, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 60)) + scale_y_log10()
```

## did_police_officer_attend_scene_of_accident

```{r}
full_collisions %>% ggplot(aes(x = did_police_officer_attend_scene_of_accident, fill = fill_colors)) + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 45)) + scale_y_log10()
```

## trunk_road_flag

```{r}
full_collisions %>% ggplot(aes(x = trunk_road_flag, fill = fill_colors)) + scale_y_log10() + 
  geom_bar(position = "fill") + scale_x_discrete(guide = guide_axis(angle = 45)) 
```

#####################
```{r}
full_collisions %>% group_by(number_of_casualties, trunk_road_flag) %>% summarise(n = n()) %>% ungroup()
```


